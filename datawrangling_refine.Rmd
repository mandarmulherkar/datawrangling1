---
title: "Springboard data wrangling exercise 1"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r}
library(dplyr)
library(tidyr)
library(stringr)
library(readr)
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.
```{r}
original <- read_csv("~/autogravity/rworkspace/refinedata/refine_original.csv")
names(original)[names(original) == 'Product code / number'] <- "product_code_number"
```
```{r}
original$company
factor(original$company)
original$company <- tolower(original$company)
original$company
phi_indices <- grep("(ips|phi)", original$company, ignore.case = TRUE)
phi_indices
akzo_indices <- grep("(z|ak)", original$company, ignore.case = TRUE)
akzo_indices
unilever_indices <- grep("(uni|lev)", original$company, ignore.case = TRUE)
unilever_indices
van_indices <- grep("(van|hou)", original$company, ignore.case = TRUE)
van_indices

# Since the data set is small, and the values are well defined, a brute force approach.
for (i in 1:length(original$company)) {
  if (i %in% phi_indices) {
    original$company[i] <- "philips"
  }
}

for (i in 1:length(original$company)) {
  if (i %in% akzo_indices) {
    original$company[i] <- "akzo"
  }
}

for (i in 1:length(original$company)) {
  if (i %in% unilever_indices) {
    original$company[i] <- "unilever"
  }
}
# factor(original$company)
# original
```

```{r}
# Separate the product code and number.
# http://stackoverflow.com/questions/4350440/split-a-column-of-a-data-frame-to-multiple-columns
# https://blog.rstudio.org/2014/07/22/introducing-tidyr/
original_new_cols <- original %>%
  separate(product_code_number, into = c("product_code", "product_number"), sep = "-")
original_new_cols
```
```{r}
# Add product categories
for (i in 1:length(original_new_cols$product_code)) {
  if (original_new_cols$product_code[i] == "p") {
    original_new_cols$product_code[i] <- "Smartphone"
  }
  if (original_new_cols$product_code[i] == "v") {
    original_new_cols$product_code[i] <- "TV"
  }
  if (original_new_cols$product_code[i] == "x") {
    original_new_cols$product_code[i] <- "Laptop"
  }
  if (original_new_cols$product_code[i] == "q") {
    original_new_cols$product_code[i] <- "Tablet"
  }
}
```

```{r}
original_new_cols <- original_new_cols %>% unite(full_address, address, city, country, sep = ",")
```

```{r}
# Add four binary (1 or 0) columns for company: company_philips, company_akzo, company_van_houten and company_unilever.
original_new_cols <- original_new_cols %>% mutate(company_philips = 0, company_akzo = 0, company_van_houten = 0, company_unilever = 0)
original_new_cols
for(i in 1:length(original_new_cols$company)) {
  if (original_new_cols$company[i] == "philips") {
    original_new_cols$company_philips[i] = 1
  }
  if (original_new_cols$company[i] == "akzo") {
    original_new_cols$company_akzo[i] = 1
  }
  if (original_new_cols$company[i] == "van houten") {
    original_new_cols$company_van_houten[i] = 1
  }
  if (original_new_cols$company[i] == "unilever") {
    original_new_cols$company_unilever[i] = 1
  }
}
original_new_cols
```
```{r}
# Add four binary (1 or 0) columns for product category: product_smartphone, product_tv, product_laptop and product_tablet.
original_new_cols <- original_new_cols %>% mutate(product_smartphone = 0, product_tv = 0, product_laptop = 0, product_tablet = 0)
for(i in 1:length(original_new_cols$product_code)) {
  if (original_new_cols$product_code[i] == "Smartphone") {
    original_new_cols$product_smartphone[i] = 1
  }
  if (original_new_cols$product_code[i] == "TV") {
    original_new_cols$product_tv[i] = 1
  }
  if (original_new_cols$product_code[i] == "Laptop") {
    original_new_cols$product_laptop[i] = 1
  }
  if (original_new_cols$product_code[i] == "Tablet") {
    original_new_cols$product_tablet[i] = 1
  }
}
original_new_cols
```

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file).
